<!DOCTYPE html>
<html>
<head>
    <title>Test Substack API</title>
</head>
<body>
    <h1>Substack API Test</h1>
    <div id="result"></div>
    <script>
        async function testSubstackAPI() {
            const resultDiv = document.getElementById('result');
            
            try {
                // Test 1: Direct API call
                resultDiv.innerHTML += '<h2>Test 1: Direct API Call</h2>';
                const response = await fetch('http://localhost:4444/api/substack/posts');
                resultDiv.innerHTML += `<p>Status: ${response.status}</p>`;
                resultDiv.innerHTML += `<p>Content-Type: ${response.headers.get('content-type')}</p>`;
                
                const text = await response.text();
                resultDiv.innerHTML += `<p>Response length: ${text.length} characters</p>`;
                resultDiv.innerHTML += `<p>First 200 chars: <pre>${text.substring(0, 200)}</pre></p>`;
                
                // Test 2: Parse as XML
                resultDiv.innerHTML += '<h2>Test 2: XML Parsing</h2>';
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'application/xml');
                const items = doc.querySelectorAll('item');
                resultDiv.innerHTML += `<p>Found ${items.length} items</p>`;
                
                if (items.length > 0) {
                    const firstItem = items[0];
                    const title = firstItem.querySelector('title')?.textContent || 'No title';
                    const description = firstItem.querySelector('description')?.textContent || 'No description';
                    resultDiv.innerHTML += `<p>First post title: ${title}</p>`;
                    resultDiv.innerHTML += `<p>First post description: ${description}</p>`;
                }
                
                // Test 3: Check for parsing errors
                const parserError = doc.querySelector('parsererror');
                if (parserError) {
                    resultDiv.innerHTML += `<p style="color:red">Parser error: ${parserError.textContent}</p>`;
                }
                
            } catch (error) {
                resultDiv.innerHTML += `<p style="color:red">Error: ${error.message}</p>`;
                console.error('Test error:', error);
            }
        }
        
        testSubstackAPI();
    </script>
</body>
</html>